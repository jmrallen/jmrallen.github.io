<!DOCTYPE html>
<html>
  <head>
    <title>Central Asia Sentinel-2 Mosaic - Jeremy Allen</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="../../assets/css/main.css" />
    <link rel="stylesheet" href="../../assets/css/theme.css" />
    <link rel="stylesheet" href="../../assets/css/nav.css" />
    <link rel="stylesheet" href="../../assets/css/overrides.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../favico.ico">
    <script src="../../assets/js/theme-toggle.js"></script>
  </head>
  <body class="is-preload no-sidebar">

    <!-- Navigation -->
    <nav class="site-nav">
      <ul class="nav-links">
        <li><a href="../../index.html">Home</a></li>
        <li><a href="../../publications.html">Publications</a></li>
        <li><a href="../index.html" class="active">Cartography</a></li>
        <li><a href="../../cv.html">CV</a></li>
        <li><a href="../../contact.html">Contact</a></li>
      </ul>
      <div class="nav-right">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
          <i class="fas fa-moon"></i>
        </button>
        <button class="nav-hamburger" onclick="this.parentElement.previousElementSibling.classList.toggle('open')" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </nav>

    <!-- Main -->
    <div id="main">
      <div class="project-header">
        <h1>Central Asia Sentinel-2 Mosaic</h1>
        <div class="project-meta">
          <span><i class="fas fa-calendar-alt"></i> 2025</span>
          <span><i class="fas fa-layer-group"></i> Satellite Imagery / Remote Sensing</span>
        </div>
        <div class="project-tags">
          <span>Sentinel-2</span>
          <span>Google Earth Engine</span>
          <span>Blender</span>
          <span>Central Asia</span>
        </div>
      </div>

      <p>A cloud-free Sentinel-2 composite mosaic of Central Asia, created from imagery spanning 2017&ndash;2023. The satellite composite was generated in Google Earth Engine using aggressive cloud and shadow masking, then overlaid on a Blender-rendered digital elevation model to produce a final image that combines spectral detail with topographic relief.</p>

      <figure class="project-image">
        <img src="../../images/central-asia-S2.jpg" alt="Central Asia Sentinel-2 cloud-free composite mosaic over Blender DEM render" />
        <figcaption>Cloud-free Sentinel-2 median composite of Central Asia, overlaid on a Blender DEM render. False colour (B5, B4, B3).</figcaption>
      </figure>

      <h2>Subsets</h2>
      <p>Close-up views from the mosaic, highlighting the diversity of landscapes across Central Asia.</p>

      <div class="subset-grid">
        <figure>
          <img src="../../images/central-asia-S2-termez.jpg" alt="Termez, Uzbekistan" />
          <figcaption>Termez, Uzbekistan</figcaption>
        </figure>
        <figure>
          <img src="../../images/central-asia-S2-karakul.jpg" alt="Lake Karakul, Tajikistan" />
          <figcaption>Lake Karakul, Tajikistan</figcaption>
        </figure>
        <figure>
          <img src="../../images/central-asia-S2-kashmir.jpg" alt="Kashmir" />
          <figcaption>Kashmir</figcaption>
        </figure>
        <figure>
          <img src="../../images/central-asia-S2-yarkant.jpg" alt="Yarkant, China" />
          <figcaption>Yarkant, China</figcaption>
        </figure>
      </div>

      <h2>Methodology</h2>

      <p>The composite was produced using the cloud masking approach described in the <a href="https://developers.google.com/earth-engine/tutorials/community/sentinel-2-s2cloudless" target="_blank" rel="noopener">Sentinel-2 Cloud Masking with s2cloudless</a> tutorial. Three Sentinel-2 collections are combined: Level 1C (for Cloud Displacement Index bands), the S2_CLOUD_PROBABILITY dataset, and Level 2A surface reflectance.</p>

      <h3>Data Setup</h3>
      <p>The three collections are filtered to the area of interest and date range (2017&ndash;2023). The date range spans multiple years to maximise the availability of cloud-free pixels, with a natural bias towards summer imagery.</p>

<pre><code class="language-javascript">// Sentinel-2 Level 1C data. Bands B7, B8, B8A and B10 from this
// dataset are needed as input to CDI and the cloud mask function.
var s2 = ee.ImageCollection('COPERNICUS/S2');
// Cloud probability dataset. The probability band is used in
// the cloud mask function.
var s2c = ee.ImageCollection('COPERNICUS/S2_CLOUD_PROBABILITY');
// Sentinel-2 surface reflectance data for the composite.
var s2Sr = ee.ImageCollection('COPERNICUS/S2_SR');

// Dates over which to create a median composite.
var start = ee.Date('2017-01-01');
var end = ee.Date('2023-05-30');

// S2 L1C for Cloud Displacement Index (CDI) bands.
s2 = s2.filterBounds(aoi).filterDate(start, end)
    .select(['B7', 'B8', 'B8A', 'B10']);
// S2Cloudless for the cloud probability band.
s2c = s2c.filterDate(start, end).filterBounds(aoi);
// S2 L2A for surface reflectance bands.
s2Sr = s2Sr.filterDate(start, end).filterBounds(aoi)
    .select(['B2', 'B3', 'B4', 'B5', 'B6']);</code></pre>

      <h3>Collection Joining</h3>
      <p>The three collections are joined on their <code>system:index</code> property so that each surface reflectance image is paired with its corresponding cloud probability and L1C bands.</p>

<pre><code class="language-javascript">// Join two collections on their 'system:index' property.
function indexJoin(collectionA, collectionB, propertyName) {
  var joined = ee.ImageCollection(ee.Join.saveFirst(propertyName).apply({
    primary: collectionA,
    secondary: collectionB,
    condition: ee.Filter.equals({
      leftField: 'system:index',
      rightField: 'system:index'})
  }));
  return joined.map(function(image) {
    return image.addBands(ee.Image(image.get(propertyName)));
  });
}

// Join the cloud probability dataset to surface reflectance.
var withCloudProbability = indexJoin(s2Sr, s2c, 'cloud_probability');
// Join the L1C data to get the bands needed for CDI.
var withS2L1C = indexJoin(withCloudProbability, s2, 'l1c');</code></pre>

      <h3>Cloud Masking</h3>
      <p>Each image is masked using a combination of the Cloud Displacement Index (CDI), cloud probability, and cirrus band thresholds. Low-to-mid atmospheric clouds are identified where probability exceeds 70% and CDI is below &minus;0.2. Cirrus clouds are flagged where the B10 band exceeds 0.02. Shadows are projected from detected clouds using the solar azimuth angle.</p>

<pre><code class="language-javascript">function maskImage(image) {
  // Compute the cloud displacement index from the L1C bands.
  var cdi = ee.Algorithms.Sentinel2.CDI(image);
  var s2c = image.select('probability');
  var cirrus = image.select('B10').multiply(0.0001);

  // Assume low-to-mid atmospheric clouds to be pixels where probability
  // is greater than 70%, and CDI is less than -0.2. For higher atmosphere
  // cirrus clouds, assume the cirrus band is greater than 0.02.
  var isCloud = s2c.gt(70).and(cdi.lt(-0.2)).or(cirrus.gt(0.02));

  // Reproject is required to perform spatial operations at 20m scale.
  isCloud = isCloud.focal_min(3).focal_max(16);
  isCloud = isCloud.reproject({crs: cdi.projection(), scale: 20});

  // Project shadows from clouds using the solar azimuth angle.
  var shadowAzimuth = ee.Number(90)
      .subtract(ee.Number(image.get('MEAN_SOLAR_AZIMUTH_ANGLE')));

  isCloud = isCloud.directionalDistanceTransform(shadowAzimuth, 50);
  isCloud = isCloud.reproject({crs: cdi.projection(), scale: 100});

  isCloud = isCloud.select('distance').mask();
  return image.select('B2', 'B3', 'B4', 'B5', 'B6').updateMask(isCloud.not());
}</code></pre>

      <h3>Composite Generation</h3>
      <p>The masked collection is reduced to a median composite and exported at 10 m resolution. The false-colour visualisation uses bands B5, B4, and B3 (vegetation-sensitive near-infrared composite).</p>

<pre><code class="language-javascript">// Map the cloud masking function over the joined collection.
var masked = ee.ImageCollection(withS2L1C.map(maskImage));

// Take the median composite.
var median = masked.median().clip(aoi);

// Display the results.
var viz = {bands: ['B5', 'B4', 'B3'], min: 0, max: 3000};
Map.addLayer(median, viz, 'median');

// Export the image at 10m resolution.
Export.image.toDrive({
  image: median,
  description: 'CentralAsia_S2_Composite',
  crs: 'EPSG:4326',
  region: aoi,
  scale: 10,
  maxPixels: 150000000
});</code></pre>

      <h3>DEM Overlay</h3>
      <p>The exported composite was overlaid on a hillshade relief rendered in Blender, following the approach described in the <a href="https://somethingaboutmaps.wordpress.com/blender-relief-tutorial-getting-set-up/" target="_blank" rel="noopener">Blender Relief Tutorial</a> by Daniel Huffman. The DEM render provides topographic context, adding depth and texture to the satellite imagery.</p>

      <!-- Project Navigation -->
      <div class="project-nav">
        <a href="../panjshir-offensives/index.html"><i class="fas fa-arrow-left"></i> Previous: Panjshir Offensives</a>
        <span></span>
      </div>
    </div>

    <!-- Footer -->
    <footer id="footer">
      <div class="inner">
        <ul class="icons">
          <li><a href="https://x.com/Jeremallen" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
          <li><a href="https://github.com/jmrallen" class="icon brands fa-github"><span class="label">Github</span></a></li>
          <li><a href="https://www.linkedin.com/in/jeremy-a-6918aa1a9/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li>
        </ul>
        <ul class="copyright">
          <li>&copy; 2026 Jeremy Allen</li>
        </ul>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/js/jquery.poptrox.min.js"></script>
    <script src="../../assets/js/browser.min.js"></script>
    <script src="../../assets/js/breakpoints.min.js"></script>
    <script src="../../assets/js/util.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

  </body>
</html>
